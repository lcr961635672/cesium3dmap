<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>淹没分析</title>
    <script src="/static/lib/Cesium-1.77/Cesium.js"></script>
    <link rel="stylesheet" href="/static/lib/Cesium-1.77/Widgets/widgets.css">
    <style>
        html,
        body,
        #cesiumContainer {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000000;
        }
    </style>

</head>

<body>
  <div id="cesiumContainer">
  </div>
  <script>
    var viewer = new Cesium.Viewer('cesiumContainer', {
      imageryProvider: new Cesium.UrlTemplateImageryProvider({
        url: 'http://www.google.cn/maps/vt?lyrs=s@716&x={x}&y={y}&z={z}'
      })
    });

    viewer.scene.globe.depthTestAgainstTerrain = true;

    // 逆时针方向采集
    var points = [
      new Cesium.Cartesian3(-1715298.755222242, 4993163.868150364, 3566670.284367589),
      new Cesium.Cartesian3(-1715311.171357528, 4993200.250149755, 3566616.4363699225),
      new Cesium.Cartesian3(-1715368.5946029918, 4993181.188256532, 3566616.2490437743),
      new Cesium.Cartesian3(-1715398.5946029918, 4993181.188256532, 3566616.2490437743),
      new Cesium.Cartesian3(-1715357.2060158958, 4993145.530750797, 3566668.711331089)
    ];

    var pointsLength = points.length;

    var clippingPlanes = [];
    for (var i = 0; i < pointsLength; ++i) {
      var nextIndex = (i + 1) % pointsLength;
      var midpoint = Cesium.Cartesian3.add(points[i], points[nextIndex], new Cesium.Cartesian3());
      midpoint = Cesium.Cartesian3.multiplyByScalar(midpoint, 0.5, midpoint);

      var up = Cesium.Cartesian3.normalize(midpoint, new Cesium.Cartesian3());
      var right = Cesium.Cartesian3.subtract(points[nextIndex], midpoint, new Cesium.Cartesian3());
      right = Cesium.Cartesian3.normalize(right, right);

      var normal = Cesium.Cartesian3.cross(right, up, new Cesium.Cartesian3());
      normal = Cesium.Cartesian3.normalize(normal, normal);

      var originCenteredPlane = new Cesium.Plane(normal, 0.0);
      var distance = Cesium.Plane.getPointDistance(originCenteredPlane, midpoint);

      clippingPlanes.push(new Cesium.ClippingPlane(normal, distance));
    }
    viewer.scene.globe.clippingPlanes = new Cesium.ClippingPlaneCollection({
      planes: clippingPlanes,
      edgeWidth: 1.0,
      edgeColor: Cesium.Color.WHITE
    });

    viewer.camera.lookAt(new Cesium.Cartesian3(-1715298.755222242, 4993163.868150364, 3566670.284367589),
      new Cesium.HeadingPitchRange(0, -Cesium.Math.toRadians(90), 100));
    viewer.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);
  </script>
</body>

</html>
